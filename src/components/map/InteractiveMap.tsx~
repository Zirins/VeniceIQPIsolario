'use client'

import { MapContainer, TileLayer, GeoJSON } from 'react-leaflet'
import { useIsland } from '@/context/IslandContext'
import 'leaflet/dist/leaflet.css'

export default function InteractiveMap() {
  const { selectIsland, filteredIslands } = useIsland()

  console.log('[InteractiveMap] Rendering', filteredIslands.length, 'islands')

  return (
    <MapContainer center={[45.4379, 12.3346]} zoom={13} style={{ height: '100vh', width: '100%' }}>
      <Tile Layer
        url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        attribution="&copy; OpenStreetMap contributors"
      />

      {filteredIslands.map((island) => (
        <GeoJSON
          key={island.id}
          data={{
            type: 'Feature',
            properties: { id: island.id },
            geometry: island.geometry!,
          }}
          eventHandlers={{
            click: () => selectIsland(island.id),
          }}
        />
      ))}
    </MapContainer>
  )
}
